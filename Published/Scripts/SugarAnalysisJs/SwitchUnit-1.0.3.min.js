var currentUser, jsonUnitParam; $(document).ready(function () { $("#btnChangeUnit").click(function () { PostUserWorkingUnit() }), currentUser = $("#_hiddenUserCode").val(), jsonUnitParam = { StringParam: currentUser }, $("#anchorSwitchUnit").click(function () { GetUnitRights() }) }), jQuery; var GetUnitRights = function () { $.ajax({ type: "POST", url: "/api/UserMasterApi/UnitRightsList", data: JSON.stringify(jsonUnitParam), contentType: "application/json; charset=utf-8", datatype: "json", success: a => { $.each(a, function (a, b) { $("#ddlAvailableUnits").empty(), $.each(b, function (a, b) { $("#ddlAvailableUnits").append("<option class=\"dropdown-item\" value = " + b.Code + ">" + b.Name + "</option>") }) }) }, Error: a => { console.log(a) } }) }, PostUserWorkingUnit = function () { var a = { Code: currentUser, UnitCode: $("#ddlAvailableUnits").children("option:selected").val() }; $.ajax({ type: "POST", url: "/api/UserMasterApi/PostChangeWorkingUnit", contentType: "application/json", dataType: "json", data: JSON.stringify(a), success: () => { UpdateUserSession(a.UnitCode), alert("Your working unit is changed to " + $("#ddlAvailableUnits option:selected").text()), $("#ModalChangeUnit").attr("aria-hidden", "true"), $("#ModalChangeUnit").removeClass("show"), $("#ModalChangeUnit").attr("style", "display: none;"), $("body").removeClass("modal-open"), $("body").removeAttr("style") }, error: a => { console.log(a) } }) }, UpdateUserSession = function (a) { console.log(a); $.ajax({ type: "POST", url: "/SessionHandler/UpdateSessionBaseUnit/", data: JSON.stringify({ id: a }), contentType: "application/json; charset=utf-8", dataType: "json", success: a => { console.log(a) }, failure: a => { console.log(a) }, error: a => { console.log(a) } }) };