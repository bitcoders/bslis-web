var selected_unit, LatestHourlyEntryDate, tab, jsonParam, total_crush, clear_juice_brix_avg, un_sulphered_brix_avg, final_mol_brix_avg, combined_bagasse_pol_avg, hourly_sugar_bags, entry_date, entry_time, total_juice_hour = 0, total_juice_day = 0, crop_day = 0, total_water_hour = 0, total_water_day = 0, nm_pj_brix = 0, nm_pj_purity = 0, nm_bagasse_pol = 0, nm_bagasse_moisture = 0, om_pj_brix = 0, om_pj_purity = 0, om_bagasse_pol = 0, om_bagasse_moisture = 0, combined_pj_brix = 0, combined_pj_pol = 0, combined_pj_purity = 0, combined_mj_brix = 0, combined_mj_pol = 0, combined_mj_purity = 0, combined_lj_brix = 0, combined_lj_pol = 0, combined_lj_purity = 0, clear_juice_purity = 0, un_sulphered_purity = 0, press_cake_avg = 0, final_mol_purity = 0, combined_bagasse_moist_avg = 0, combined_bagasse_pol = 0, combined_bagasse_moisture = 0, standing_truck = 0, standing_trippler = 0, standing_trolley = 0, standing_cart = 0, uncrushed_cane = 0, crushed_cane = 0, total_sugar_bags = 0, today_crushed_cane = 0, today_uncrushed_cane = 0, todate_crushed_cane = 0, todate_uncrushed_cane = 0, cane_crushed = 0, estimated_sugar_percent_cane = 0, total_loss = 0, total_sugar_bagged = 0, final_molasses_sent_out_percent = 0, sugar_in_process_qtl = 0, molasses_in_process_qtl = 0, prv_day_cane_crushed = 0, todate_cane_crushed = 0, prv_day_recovery = 0, todate_recovery = 0, prv_day_losses = 0, todate_losses = 0, prv_day_sugar_bags = 0, todate_sugar_bags = 0, prv_day_final_molasses_sentout = 0, todate_final_molasses_sentout = 0, prv_day_stoppages = 0, todate_stoppages = 0, prv_day_sugar_in_proc_qtl = 0, todate_sugar_in_proc_qtl = 0, prv_day_molasses_in_proc = 0, todate_molasses_in_proc = 0; function blink_text() { $(".blink").fadeOut(500), $(".blink").fadeIn(500) } function checkForCriticalAlerts() { $.ajax({ type: "POST", url: "/api/DashBoardApi/GetDashBoardAlers", data: JSON.stringify(jsonParam), dataType: "json", contentType: "application/json; charset=utf-8", success: (t, a, e) => { t.alertMessage; "" != t.alertMessage ? ($("#div-critical-alert").length || $('<div class="alert alert-danger hide" id="div-critical-alert" name="div-critical-alert"><span class="blink" id="criticalMessageText"></span></div>').prependTo($(".content-wrapper")), $("#criticalMessageText").text(t.alertMessage), $("#div-critical-alert").fadeIn("slow"), setInterval(blink_text, 1e3), $("#div-critical-alert").removeClass("hide")) : $("#div-critical-alert").remove() }, Error: t => { console.warn("Error occured at dashboard api") } }) } function unit_one_data(t) { $.ajax({ type: "POST", url: "/api/TwoHourlySummary/", data: JSON.stringify(jsonParam), dataType: "json", contentType: "application/json; charset=utf-8", success: (t, a, e) => { 200 == e.status ? (total_crush = 0, combined_pj_brix = t[0].combined_pj_brix, combined_pj_pol = t[0].combined_pj_pol, combined_mj_brix = t[0].combined_mj_brix, combined_mj_pol = t[0].combined_mj_pol, combined_lj_brix = t[0].combined_lj_brix, combined_lj_pol = t[0].combined_lj_pol, clear_juice_brix_avg = t[0].clear_juice_brix_avg, clear_juice_purity = t[0].clear_juice_purity, un_sulphered_brix_avg = t[0].un_sulphered_brix_avg, un_sulphered_purity = t[0].un_sulphured_purity, press_cake_avg = t[0].press_cake_avg, final_mol_brix_avg = t[0].final_mol_brix_avg, final_mol_purity = t[0].final_mol_purity, combined_bagasse_pol = t[0].combined_bagasse_pol_avg, combined_bagasse_moisture = t[0].combined_bagasse_moist_avg, combined_pj_purity = (100 * combined_pj_pol / combined_pj_brix).toFixed(2), combined_mj_purity = (100 * combined_mj_pol / combined_mj_brix).toFixed(2), combined_lj_purity = (100 * combined_lj_pol / combined_lj_brix).toFixed(2)) : (total_jice = 0, total_crush = 0, combined_pj_brix = 0, combined_pj_pol = 0, combined_mj_brix = 0, combined_mj_pol = 0, combined_lj_brix = 0, combined_lj_pol = 0, clear_juice_brix_avg = 0, clear_juice_purity = 0, un_sulphered_brix_avg = 0, un_sulphered_purity = 0, press_cake_avg = 0, final_mol_brix_avg = 0, final_mol_purity = 0, combined_bagasse_pol = 0, combined_bagasse_moisture = 0, combined_pj_purity = 0, combined_mj_purity = 0, combined_lj_purity = 0) }, Error: t => { alert(t), console.log(t) } }), $.ajax({ type: "POST", url: "/api/HourlySummary/GetSummary", data: JSON.stringify(jsonParam), dataType: "json", contentType: "application/json; charset=utf-8", success: (t, a, e) => { 200 == e.status ? (total_juice_hour = t.juice_total, total_water_hour = t.water_total, standing_truck = t.standing_truck, standing_trippler = t.standing_trippler, standing_trolley = t.standing_trolley, standing_cart = t.standing_cart, uncrushed_cane = t.un_crushed_cane, crushed_cane = t.crushed_cane, hourly_sugar_bags = t.sugar_bags_total, entry_time = t.entry_time) : (total_juice_hour = 0, total_water_hour = 0, standing_truck = 0, standing_trippler = 0, standing_trolley = 0, standing_cart = 0, uncrushed_cane = 0, crushed_cane = 0, hourly_sugar_bags = 0, entry_time = "N/A") }, Error: t => { console.log(t) } }), $.ajax({ type: "POST", url: "/api/LedgerDataApi/LedgerDataForPreviousDay", data: JSON.stringify(jsonParam), dataType: "json", contentType: "application/json; charset=utf-8", success: (t, a, e) => { 200 == e.status ? (cane_crushed = t.cane_crushed, estimated_sugar_percent_cane = t.estimated_sugar_percent_cane, total_loss = t.total_losses_percent, total_sugar_bagged = t.total_sugar_bagged, final_molasses_sent_out_percent = t.final_molasses_sent_out, stoppage_hours = t.stoppage_hours, sugar_in_process_qtl = t.sugar_in_process_qtl, molasses_in_process_qtl = t.molasses_in_process_qtl) : (cane_crushed = 0, estimated_sugar_percent_cane = 0, total_loss = 0, total_sugar_bagged = 0, final_molasses_sent_out_percent = 0, stoppage_hours = 0, sugar_in_process_qtl = 0, molasses_in_process_qtl = 0) }, Error: t => { console.error(t) } }), $.ajax({ type: "POST", url: "/api/HourlySummary/GetHourlyDataForDate", data: JSON.stringify(jsonParam), contentType: "application/json; charset=utf-8", dataType: "json", success: (t, a, e) => { 200 == e.status ? (total_juice_day = t.od_juice_total, total_water_day = t.od_water_total, total_sugar_bags = t.od_total_bags, entry_date = t.entry_date.substring(0, 10), today_crushed_cane = t.od_crushed, today_uncrushed_cane = t.od_uncrushed, todate_crushed_cane = t.td_crushed, todate_uncrushed_cane = t.td_uncrushed) : (total_juice_day = 0, total_water_day = 0, total_sugar_bags = 0, entry_date = "NA", today_crushed_cane = 0, today_uncrushed_cane = 0, todate_crushed_cane = 0, todate_uncrushed_cane = 0) }, Error: t => { console.error(t) } }), $.ajax({ type: "POST", url: "/api/LedgerDataApi/GetLedgerDataToDatesAsync", data: JSON.stringify(jsonParam), dataType: "json", contentType: "application/json; charset=utf-8", success: (t, a, e) => { todate_cane_crushed = t.data.cane_crushed, todate_recovery = t.data.estimated_suagar_percent, todate_losses = t.data.total_loss_percent, todate_sugar_bags = t.data.total_sugar_bags, todate_final_molasses_sentout = t.data.final_molasses_sent_out, todate_sugar_in_proc_qtl = t.data.sugar_in_process, todate_molasses_in_proc = t.data.molasses_in_process }, Error: t => { console.error(t) } }), $.ajax({ type: "POST", url: "/api/StoppageApi/PostStoppageSummary", data: JSON.stringify(jsonParam), datatype: "json", contentType: "application/json; charset=utf-8", success: (a, e, _) => { prv_day_stoppages = Math.floor(a.TotalDuration / 60) + ":" + Math.floor(a.TotalDuration % 60), todate_stoppages = Math.floor(a.td_TotalDuration / 60) + ":" + Math.floor(a.td_TotalDuration % 60), assignValuesToDOM(t) } }) } function assignValuesToDOM(t) { tab = "#tab-" + t, console.log("assigning dom " + tab), $("#EntryDate").text(entry_date), $("#EntryTime").text(entry_time), $(tab + "-total-juice-hour").text(total_juice_hour), $(tab + "-total-juice-day").text(total_juice_day), $(tab + "-total-water-hour").text(total_water_hour), $(tab + "-total-water-day").text(total_water_day), $(tab + "-total-crushing-hour").text(crushed_cane), $(tab + "-total-crushing-day").text(today_crushed_cane), $(tab + "-total-SugarBags-hour").text(hourly_sugar_bags), $(tab + "-total-SugarBags-day").text(total_sugar_bags), $(tab + "-combined_pj_brix").text(combined_pj_brix), $(tab + "-combined_pj_purity").text(combined_pj_purity), $(tab + "-combined_mj_brix").text(combined_mj_brix), $(tab + "-combined_mj_purity").text(combined_mj_purity), $(tab + "-combined_lj_brix").text(combined_lj_brix), $(tab + "-combined_lj_purity").text(combined_lj_purity), $(tab + "-clear_juice_brix_avg").text(clear_juice_brix_avg), $(tab + "-clear_juice_purity").text(clear_juice_purity), $(tab + "-un_sulphered_brix_avg").text(un_sulphered_brix_avg), $(tab + "-un_sulphered_purity").text(un_sulphered_purity), $(tab + "-press_cake_avg").text(press_cake_avg), $(tab + "-final_mol_brix_avg").text(final_mol_brix_avg), $(tab + "-final_mol_purity").text(final_mol_purity), $(tab + "-combined_bagasse_pol_avg").text(combined_bagasse_pol), $(tab + "-combined_bagasse_moist_avg").text(combined_bagasse_moisture), $(tab + "-standing_truck").text(standing_truck), $(tab + "-standing_trippler").text(standing_trippler), $(tab + "-standing_trolley").text(standing_trolley), $(tab + "-standing_cart").text(standing_cart), $(tab + "-uncrushed_cane").text(uncrushed_cane), $(tab + "-crushed_cane").text(crushed_cane + "/" + today_crushed_cane), $("#prv-day-cane-crushed").text(cane_crushed), $("#prv_todate-cane-crushed").text(todate_cane_crushed), $("#prv-day-recovery").text(estimated_sugar_percent_cane), $("#prv_todate-day-recovery").text(todate_recovery), $("#prv-day-losess").text(total_loss), $("#prv_todate-losses").text(todate_losses), $("#prv-day-sugar-bags").text(total_sugar_bagged), $("#prv_todate-sugar-bags").text(todate_sugar_bags), $("#prv-day-final-mol-sent").text(final_molasses_sent_out_percent), $("#prv_todate-final-mol-sent").text(todate_final_molasses_sentout), $("#prv-day-stoppage").text(prv_day_stoppages), $("#prv_todate-stoppage").text(todate_stoppages), $("#prv-day-sugar-in-proc").text(sugar_in_process_qtl), $("#prv_todate-sugar-in-proc").text(todate_sugar_in_proc_qtl), $("#prv-day-mol-in-proc").text(molasses_in_process_qtl), $("#prv_todate-mol-in-proc").text(todate_molasses_in_proc) } function executeFunctionChain() { selected_unit = $(".dashboard-tab").attr("href").replace("#tab-", ""), jsonParam = { unit_code: selected_unit }, checkForCriticalAlerts(), unit_one_data(selected_unit), $(".dashboard-tab").click(function () { selected_unit = $(this).attr("href").replace("#tab-", ""), jsonParam = { unit_code: selected_unit }, checkForCriticalAlerts(), tab = "#tab-" + selected_unit, unit_one_data(selected_unit) }), setInterval(function () { selected_unit = $(".dashboard-tab").filter(".active").attr("href").replace("#tab-", ""), tab = "#tab-" + selected_unit, unit_one_data(selected_unit), assignValuesToDOM(selected_unit) }, 1e4) } $(document).ready(function () { executeFunctionChain() });