var Data, headCode = 0, subHeadDdl = $("#s_sub_head_code"); $("#s_head_code").change(function () { var a = $("#s_head_code").children("option:selected").text(); $("#s_head_name").val(a), headCode = $(this).val(), subHeadDdl.empty(), 0 == $("#s_head_code").val() && subHeadDdl.attr("disabled", "disabled"), subHeadDdl.append("<option selected=\"true\" disabled>--Choose Sub Type--</option>"), subHeadDdl.prop("selectedIndex"), x() }), $("#s_sub_head_code").change(function () { var a = $(this).children("option:selected").text(); $("#s_sub_head_name").val(a) }); var x = function () { var a = { id: headCode }; $.ajax({ type: "POST", url: "/stoppage/AjaxGetSubStoppage/", data: JSON.stringify(a), contentType: "application/json; charset=utf-8", success: function (a) { $.each(a.StoppageSubTypes, function (a, b) { subHeadDdl.append($("<option></option>").attr("value", b.Value).text(b.Text)) }) }, error: a => { console.log(a) } }) }; function endStoppage() { function a(a) { var b = a.split(":"), c = new Date; return c.setHours(b[0]), c.setMinutes(b[1]), c } function b(a, b) { return (b - a) / 60000 } var c = $("#s_date").val(); c = c.split("-"); var d = new Date(c[2], c[1] - 1, c[0]), e = a($("#s_start_time").val()), f = a($("#s_end_time").val()), g = 0; f <= e ? (f.setDate(f.getDate() + 1), g = b(e, f), $("#s_duration").val(g)) : (g = b(e, f), $("#s_duration").val(g)), isNaN(g) ? ($("#s_duration").val(0), $("#btnSubmit").attr("disabled", "true")) : $("#btnSubmit").removeAttr("disabled") } var formName = $("#s_end_time").parents("form").attr("id"); "frmCloseStoppage" == formName && $("#s_end_time").blur(function () { endStoppage() }), "frmChangeReason" == formName && (headCode = $("#s_head_code").children("option:selected").val(), x()), (formname = "frmChangeStoppageTime") && $(document).ready(function () { headCode = $("#s_head_code").children("option:selected").val(), x(), $("#btnSubmit").click(function () { endStoppage() }), $("#s_end_time").blur(function () { endStoppage() }), $("#s_start_time").blur(function () { endStoppage() }) });